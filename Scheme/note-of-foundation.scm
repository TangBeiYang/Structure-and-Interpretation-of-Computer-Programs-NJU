; ============================================
; Scheme 语言基础
; 注：Scheme是Lisp方言，函数式编程语言,elegant
; ============================================

; ============================================
; 1. Scheme表达式类型(Scheme中万物皆为表达式)
; ============================================

; 1.1 原子表达式 (Atomic Expressions)
; - 自求值表达式: 数字、布尔值
3        ; 整数
5.5      ; 浮点数
-10      ; 负数
#t       ; 真值
#f       ; 假值 (只要不是#f,就为真)

; - 符号: 绑定到值的名称
+        ; 加法函数符号
modulo   ; 取模函数符号
list     ; 列表函数符号
x        ; 变量符号
foo      ; 自定义符号
hello-world ; 符号可以包含连字符

; ============================================
; 2. 组合表达式 (Combinations)
; ============================================

; 组合表达式格式: (<operator> <operand1> <operand2> ...)
; 可以是函数调用表达式或特殊形式表达式

; ============================================
; 3. 函数调用表达式 (Call Expressions)
; ============================================

; 求值步骤:
; 1. 求值运算符(operator)得到过程(procedure)
; 2. 从左到右求值所有运算元(operand)得到参数
; 3. 将过程应用于参数

; 示例:
(quotient (+ 8 7) 5)      ; => 3 (先计算15，再除以5)
(+ (* 3
      (+ (* 2 4)
         (+ 3 5)))
   (+ (- 10 7)
      6))                 ; 空格和换行不影响求值

; ============================================
; 4. 特殊形式表达式 (Special Form Expressions)
; ============================================

; 特殊形式: define, if, lambda等

; ============================================
; 5. define 特殊形式 - 绑定名称
; ============================================

; 格式: (define <name> <expr>)
; 求值步骤:
; 1. 求值给定表达式
; 2. 将结果值绑定到当前帧中的给定名称
; 3. 返回名称作为符号

(define x (+ 3 4))        ; => x (符号), 实际值: 7
(define x (+ x 5))        ; 重新定义x: 7+5=12

; ============================================
; 6. define 特殊形式 - 定义命名函数
; ============================================

; 格式: (define (<name> <param1> <param2> ...) <body>)
; 这是创建命名函数的简写形式

(define (square x) (* x x)) ; 定义平方函数
; 等价于: (define square (lambda (x) (* x x)))

(square 4)                 ; => 16
(square -10)               ; => 100

; ============================================
; 7. if 特殊形式 - 控制流
; ============================================

; 格式: (if <predicate> <if-true> <if-false>)
; 注意: Scheme中只有#f是假值，其他所有值(包括0)都是真值

; 求值步骤:
; 1. 求值谓词<predicate>
; 2. 如果谓词不是#f，求值<if-true>并返回值
;   否则求值<if-false>(如果提供)并返回值

(if #t 3 5)                ; => 3 (#t为真)
(if 0 (+ 1 0) (/ 1 0))     ; => 1 (0不是#f，为真)
(if (> 10 1) (* 5 6))      ; => 30 (没有if-false部分)
(if (not 4) 1 (if #f 5 6)) ; => 6 (嵌套if)

; ============================================
; 8. lambda 特殊形式 - 匿名函数
; ============================================

; 格式: (lambda (<param1> <param2> ...) <body>)
; 求值步骤:
; 1. 创建具有给定参数和函数体的lambda过程
; 2. 返回该lambda过程

(lambda (x) (* x x))       ; 返回匿名平方函数
((lambda (x) (* x x)) 5)   ; => 25 (立即调用匿名函数)

; 两种等价的函数定义方式:
(define (plus4 x) (+ x 4))           ; 简写形式
(define plus4 (lambda (x) (+ x 4)))  ; 完整形式

; 运算符也可以是调用表达式:
((lambda (x y z) (+ x y (square z))) 1 2 3) ; 计算 1+2+3²=12

; ============================================
; 9. 递归示例 - 阶乘函数
; ============================================

; Scheme没有专门的迭代特殊形式，必须使用递归
(define (fact n)
    (if (<= n 1)            ; 基本情况: n ≤ 1
        1                   ; 返回1
        (* n (fact (- n 1))))) ; 递归情况: n * fact(n-1)

; 注意: 没有显式的return语句
; 函数体·最后一个表达式·的值就是返回值

; ============================================
; 10. 递归示例 - 计数函数
; ============================================

(define (count-up n)
    (define (counter k)      ; 内部辅助函数
        (print k)            ; 打印当前值
        (if (< k n)          ; 如果k < n
            (counter (+ k 1)))) ; 递归调用counter(k+1)
    (counter 1))             ; 从1开始计数

; 注意: 
; 1. 函数体中有多个表达式时，返回最后一个表达式的值
; 2. 可以使用内部定义(嵌套函数)

; ============================================
; 11. Scheme语言特点总结(函数式编程语言特点)
; ============================================

; 1. 表达式中心主义:
;    - 程序完全由表达式组成
;    - 每个表达式都有返回值
;    - 没有"语句"的概念

; 2. 括号语法(S-expression):
;    - 所有代码都用括号表示
;    - 格式: (函数 参数1 参数2 ...)
;    - 前缀表示法

; 3. 最小语法:
;    - 只有两种表达式类型: 原子表达式和组合表达式
;    - 组合表达式分为: 函数调用和特殊形式

; 4. 函数是一等公民:
;    - 函数可以作为参数传递
;    - 函数可以作为返回值
;    - 支持匿名函数(lambda)

; 5. 递归而非迭代:
;    - 没有专门的循环结构
;    - 可以使用尾递归优化
;    - 必须使用递归实现循环逻辑

; 6. 动态类型:
;    - 变量没有类型声明
;    - 类型检查在运行时进行

; 7. 代码即数据:
;    - 程序可以操作自身代码
;    - 支持元编程

; ============================================
; 关键理解要点
; ============================================

; 1. Scheme程序只由表达式组成
; 2. 组合表达式分为函数调用和特殊形式
; 3. 不同特殊形式有各自的求值规则
; 4. 必须使用递归实现迭代逻辑
; 5. #f是唯一假值，其他所有值都是真值
; 6. 函数体最后一个表达式的值就是返回值
